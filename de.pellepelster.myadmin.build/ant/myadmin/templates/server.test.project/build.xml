<project name="@ant.project.name@" xmlns:ivy="antlib:org.apache.ivy.ant">

	<import file="@ant.common.file@" />

	<property file="build.properties" />

	<property name="jetty.temp.location" value="${basedir}/jetty-temp" />
	<property name="db.temp.location" value="${basedir}/db-temp" />
	<property name="jetty.lib.dir" value="${basedir}/jetty-lib" />

	<macrodef name="openInBrowser">
		<attribute name="url" />
		<sequential>
			<exec dir="${basedir}" os="Windows 7" executable="rundll32.exe">
				<arg line="url.dll, FileProtocolHandler" />
				<arg line="@{url}" />
			</exec>
			<exec dir="${basedir}" os="Linux" executable="xdg-open">
				<arg line="@{url}" />
			</exec>
		</sequential>
	</macrodef>


	<target name="run.local" depends="resolve">

		<taskdef resource="cargo.tasks">
			<classpath>
				<pathelement location="lib/cargo-core-uberjar-jar.jar" />
				<pathelement location="lib/cargo-ant-jar.jar" />
				<fileset dir="lib" includes="*jar" />
			</classpath>
		</taskdef>

		<mkdir dir="tomcat" />
		<mkdir dir="tomcat/downloads" />
		<mkdir dir="tomcat/extracts" />
		<mkdir dir="tomcat/logs" />

		<cargo containerId="tomcat6x" output="tomcat/logs/output.log" log="tomcat/logs/cargo.log" action="run">

			<zipUrlInstaller installUrl="http://www.apache.org/dist/tomcat/tomcat-6/v6.0.36/bin/apache-tomcat-6.0.36.zip" downloadDir="tomcat/downloads" extractDir="tomcat/server" />

			<extraClasspath>
				<pathelement location="lib/derby-jar.jar" />
			</extraClasspath>

			<configuration>
				<property name="cargo.servlet.port" value="8080" />
				<property name="cargo.jvmargs" value="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=9999 -Xnoagent -Djava.compiler=NONE" />
				<property name="cargo.datasource.datasource1" value="cargo.datasource.driver=org.apache.derby.jdbc.EmbeddedDriver|cargo.datasource.url=jdbc:derby:derbyDB;create=true|cargo.datasource.jndi=jdbc/@project.name.camelcase@|cargo.datasource.username=@project.name@|cargo.datasource.password=nonemptypassword" />
				<deployable type="war" file="../@organisation.name@.@project.name@.server/${build.dir}/@organisation.name@.@project.name@.war" />
			</configuration>

		</cargo>
	</target>

	<target name="import.dictionary" depends="resolve">

		<taskdef name="dictionaryimporter" classpathref="lib.path.id" classname="de.pellepelster.myadmin.tools.dictionary.DictionaryImporter" />
		<dictionaryimporter classpathref="lib.path.id" modelfile="classpath:@project.name.camelcase@.msl" remotepath="${remote.path}" remoteport="${remote.port}" remoteuser="${remote.username}" remotepassword="${remote.password}" remoteserver="${remote.server}" />

	</target>

	<target name="start.client">
		<openInBrowser url="http://${remote.server}:${remote.port}/@organisation.name@.@project.name@/@project.name.camelcase@/@project.name.camelcase@.html"/>
	</target>

</project>

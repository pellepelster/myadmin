<?xml version="1.0"?>
<project name="de.pellepelster.myadmin.documentation" default="all">

	<path id="fop.classpath">
		<fileset dir="fop/lib/" includes="*.jar" />
		<fileset dir="fop/build/" includes="*.jar" />
	</path>

	<fileset id="src.files" dir="src" includes="MyAdmin.xml" />

	<taskdef name="fop" classname="org.apache.fop.tools.anttasks.Fop" classpathref="fop.classpath" />

	<property name="docbook.xsl.dir" value="${basedir}/xsl" />

	<property name="output.dir" value="${basedir}/output/" />
	<property name="src" value="${basedir}/src" />
	<property name="output.temp.dir" value="${basedir}/temp" />

	<property name="html.stylesheet" value="${docbook.xsl.dir}/jboss/xhtml-single.xsl" />
	<property name="chunk-html.stylesheet" value="${docbook.xsl.dir}/jboss/xhtml.xsl" />

	
	
	<property name="fo.stylesheet" value="${docbook.xsl.dir}/jboss/pdf.xsl" />
	<property name="eclipse.stylesheet" value="${docbook.xsl.dir}/eclipse/eclipse.xsl" />
	
	<target name="clean" description="Cleans up generated files.">
		<delete dir="${output.dir}" />
		<delete dir="${output.temp.dir}" />
	</target>

	<target name="init" depends="clean">
		<mkdir dir="${output.dir}" />
		<mkdir dir="${output.temp.dir}" />
	</target>

	<!--
      - target:  copy 
      - Copies the images from the subdirectories to the target folder
    -->
	<target name="copy">
		<echo message="Copy the images" />
		<copy todir="${output.dir}">
			<fileset dir="${src}">
				<include name="**/images/*.*" />
			</fileset>
		</copy>
	</target>

	<target name="build.html" depends="init" description="Generates HTML files from DocBook XML">
		<xslt style="${html.stylesheet}" extension=".html" basedir="${output.temp.dir}" destdir="${output.dir}">
			<classpath refid="fop.classpath" />
			
			<factory name="org.apache.xalan.processor.TransformerFactoryImpl">
				<attribute name="http://xml.apache.org/xalan/features/optimize" value="true" />
			</factory>
			
			<fileset refid="src.files" />
		</xslt>

		<copy todir="${output.dir}">
			<fileset dir="output-lib" includes="**/*" />
		</copy>
		
	</target>

	<target name="build.html.chunked" depends="init" description="Generates chunk HTML files from DocBook XML">
		<xslt style="${html.stylesheet}" extension=".html" basedir="${output.temp.dir}" destdir="${output.dir}">
			
			<classpath refid="fop.classpath" />
			<factory name="org.apache.xalan.processor.TransformerFactoryImpl">
				<attribute name="http://xml.apache.org/xalan/features/optimize" value="true" />
			</factory>

			<fileset refid="src.files" />
		</xslt>
		
		<copy todir="${output.dir}">
			<fileset dir="output-lib" includes="**/*" />
		</copy>
	</target>

	<target name="build.pdf" depends="init" description="Generates HTML files from DocBook XML">
		
		<!-- Convert DocBook Files into FO -->
		<xslt style="${fo.stylesheet}" extension=".fo" basedir="${output.temp.dir}" destdir="${output.temp.dir}">

			<classpath refid="fop.classpath" />
			<factory name="org.apache.xalan.processor.TransformerFactoryImpl">
				<attribute name="http://xml.apache.org/xalan/features/optimize" value="true" />
			</factory>

			<fileset refid="src.files" />
			
			<param name="section.autolabel" expression="1" />
			
		</xslt>
		<!-- Convert FO Files into pdf
		<fop format="application/pdf" outdir="${output.dir}" relativebase="true">
			<fileset dir="${output.temp.dir}">
				<include name="**/*.fo" />
			</fileset>
		</fop>
		 		 -->
	</target>

	<target name="build.eclipse" depends="init" description="Generates Eclipse help files from DocBook XML">
		<xslt style="${eclipse.stylesheet}" basedir="${output.temp.dir}" destdir="${output.dir}">

			<classpath refid="fop.classpath" />
			<factory name="org.apache.xalan.processor.TransformerFactoryImpl">
				<attribute name="http://xml.apache.org/xalan/features/optimize" value="true" />
			</factory>

			<fileset refid="src.files" />
				
		</xslt>
	</target>

	<target name="all" depends="copy, build.html">
	</target>

</project>
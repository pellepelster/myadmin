<project name="de.pellepelster.myadmin.demo.server.test" xmlns:ivy="antlib:org.apache.ivy.ant">

	<property name="test.suite.name" value="de.pellepelster.myadmin.demo.server.DemoTestsuite" />

	<import file="../de.pellepelster.myadmin.demo.build/ant/demo.xml" />

	<property file="build.properties" />

	<target name="tomcat.local.run" depends="resolve">
		<tomcat.local action="run" />
	</target>
	
	<target name="tomcat.local.run.debug" depends="resolve">
		<tomcat.local action="run" cargo.jvmargs="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=${remote.debug.port} -Xnoagent -Djava.compiler=NONE" />
	</target>
	

	<target name="tomcat.local.start" depends="resolve">
		<tomcat.local action="start" />
	</target>

	<target name="import.dictionary" depends="resolve">

		<taskdef name="dictionaryimporter" classpathref="lib.path.id" classname="de.pellepelster.myadmin.tools.dictionary.DictionaryImporter" />
		<dictionaryimporter classpathref="lib.path.id" modelfile="classpath:Demo.msl" remotepath="${remote.path}" remoteport="${remote.port}" remoteuser="${remote.username}" remotepassword="${remote.password}" remoteserver="${remote.server}" />

	</target>

	<target name="post.test" depends="test.selenium.local">
	</target>


	<target name="test.selenium.local" depends="tomcat.local.start, import.dictionary">

		<mkdir dir="${test.dir}"/>
		
		<junit printsummary="yes" newenvironment="yes" haltonfailure="yes" fork="true">

			<classpath refid="lib.path.id" />
			
			<classpath>
				<fileset dir="${build.dir}" includes="*.jar" excludes="*-source.jar" />
			</classpath>

			<sysproperty key="screenshot.dir" value="${test.dir}"/>
			<sysproperty key="remote.url" value="${remote.url}"/>

			<formatter type="xml" />

			<test name="de.pellepelster.myadmin.demo.server.DemoRemoteTestsuite" haltonfailure="yes" outfile="${test.dir}/de.pellepelster.myadmin.demo.server.SeleniumTests" />

		</junit>
	</target>

	<target name="start.client">
		<openInBrowser url="http://${remote.server}:${remote.port}/de.pellepelster.myadmin.demo/Demo/Demo.html"/>
	</target>

</project>
